// Generated by CoffeeScript 1.12.3
(function() {
  var LeaveForm, express, fs, genDate, genFID, router, urlToImage;

  express = require('express');

  router = express.Router();

  LeaveForm = require("../coffee/LeaveForm");

  fs = require('fs');

  router.get('/', function(req, res, next) {
    return res.send('respond with a resource');
  });

  genFID = function(name) {
    var day, dt, fID, month, year;
    dt = new Date();
    year = dt.getFullYear();
    month = dt.getMonth() + 1;
    day = dt.getDate();
    fID = year + "" + month + "" + day + "-" + name;
    return fID;
  };

  genDate = function() {
    var day, dt, month, year;
    dt = new Date();
    year = dt.getFullYear();
    month = dt.getMonth() + 1;
    day = dt.getDate();
    return year + "" + month + "" + day;
  };

  router.post('/', function(req, res) {
    var fID, name, newForm;
    name = req.body.name.replace(" ", "");
    fID = genFID(name);
    urlToImage('./dataPool/forms/' + fID + '.png', req.body.image);
    newForm = LeaveForm(name, genDate(), req.body.deputyName);
  });

  module.exports = router;

  urlToImage = function(path, url) {
    var buf, data;
    data = url.replace(/^data:image\/\w+;base64,/, "");
    buf = new Buffer(data, 'base64');
    fs.writeFile(path, buf);
  };

}).call(this);
