// Generated by CoffeeScript 1.12.3
(function() {
  var SM, debug, express, router;

  express = require('express');

  router = express.Router();

  SM = require("../coffee/SecurityManager");

  debug = require('debug')('smartLeave:security');

  router.get('/', function(req, res, next) {
    return res.render("security", {
      mainScript: '../javascripts/securityQR.js',
      style: '../stylesheets/SQR.css'
    });
  });

  router.get("/sendCertification", function(req, res, next) {
    SM.sendCertification(req.query.phoneID, req.query.tagID);
    return res.send("OK");
  });

  router.get("/QRTag", function(req, res, next) {
    var tagID;
    debug("hereh");
    res.setHeader('Content-Type', 'application/json');
    tagID = SM.getTagID();
    debug(tagID);
    return res.send(JSON.stringify({
      "QRImgPath": "code" + tagID + ".png",
      tagID: tagID
    }));
  });

  router.get("/getAccount", function(req, res, next) {
    var phoneID;
    debug(req.query.tagID);
    phoneID = SM.queryAccount("" + req.query.tagID);
    
    return res.send(phoneID);
  });

  module.exports = router;

}).call(this);
