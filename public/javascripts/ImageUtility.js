// Generated by CoffeeScript 1.12.3
(function() {
  $(document).ready(function() {
    var ImageFactory, ctx, renderForm, saveFormToImg, saveImgtoServer, showMark;
    $("#Form").hide();
    ctx = $("#Canvas")[0].getContext('2d');
    ImageFactory = function(ctx) {
      this.ctx = ctx;
      this.drawImage = function(image_arg, image_x, image_y) {
        var _this, image;
        _this = this;
        image = new Image();
        image.src = image_arg;
        image.onload = function() {
          _this.ctx.drawImage(image, image_x, image_y);
        };
      };
    };
    renderForm = function() {
      var form;
      form = $("#Form")[0];
      ctx.drawImage(form, 0, 0);
    };
    renderForm();
    showMark = function(event) {
      var str1, str2, str3;
      $(this).text("");
      str1 = "url(";
      str2 = ")";
      str3 = str1.concat(event.data.p1);
      str3 = str3.concat(str2);
      $(this).css("background-image", str3);
      $(this).css("background-image", str3);
      $(this).css("height", "50px");
      $(this).css("width", "120px");
      $(this).css("left", "350px");
    };
    saveFormToImg = function() {
      var bgImg, heightBias, imageFactory, widthBias;
      widthBias = 0;
      heightBias = 0;
      ctx = $("#Canvas")[0].getContext('2d');
      imageFactory = new ImageFactory(ctx);
      ctx.font = "50px Arial";
      ctx.fillText($("#name").text(), parseInt($("#name").css("top")), parseInt($("#name").css("left")));
      bgImg = $("#PersonalMarkButton").css("background-image");
      bgImg = bgImg.replace('url(', '').replace(')', '').replace(/\"/gi, "");
      console.log(bgImg);
      imageFactory.drawImage(bgImg, parseInt($("#PersonalMarkButton").css("left")), parseInt($("#PersonalMarkButton").css("top")));
      saveImgtoServer("upLoadForm", $("#Canvas")[0].toDataURL());
    };
    saveImgtoServer = function(url, data) {
      $.post(url, {
        image: data
      }, function(data, status) {
        alert("Data: " + data + "\nStatus: " + status);
      });
      return;
    };
    $("#submit").click(saveFormToImg);
    $('#PersonalMarkButton').click({
      p1: "./images/personalMark.jpg"
    }, showMark);
    $('#DuptyMarkButton').click({
      p1: "./images/personalMark.jpg"
    }, showMark);
    $('#supervisor').click({
      p1: "./images/personalMark.jpg"
    }, showMark);
  });

}).call(this);
